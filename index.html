<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Predicting Customer Purchasing Behavior: A Machine Learning Approach</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="clipboard.min.js"></script>
<script src="quarto.js"></script>
<script src="popper.min.js"></script>
<script src="tippy.umd.min.js"></script>
<script src="anchor.min.js"></script>
<link href="tippy.css" rel="stylesheet">
<link href="quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="bootstrap.min.js"></script>
<link href="bootstrap-icons.css" rel="stylesheet">
<link href="bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting Customer Purchasing Behavior: A Machine Learning Approach</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="project-overview" class="level3">
<h3 class="anchored" data-anchor-id="project-overview">Project Overview</h3>
<p>In this final challenge, we will apply key principles and techniques learned throughout the course to build, test, and optimize a machine learning model. The goal is to analyze customer data from the Adventure Works Cycles company to predict customer purchasing behavior.</p>
</section>
<section id="dataset-description" class="level3">
<h3 class="anchored" data-anchor-id="dataset-description">Dataset Description</h3>
<p>The Adventure Works Cycles company collected comprehensive data on their existing customers, including demographic information and purchase history. The dataset consists of three files:</p>
<ol type="1">
<li><p><strong>AdvWorksCusts.csv</strong>: Customer demographic data, containing fields such as CustomerID, Title, FirstName, LastName, Address, City, StateProvince, CountryRegion, PostalCode, PhoneNumber, BirthDate, Education, Occupation, Gender, MaritalStatus, HomeOwnerFlag, NumberCarsOwned, NumberChildrenAtHome, TotalChildren, and YearlyIncome.</p></li>
<li><p><strong>AW_AveMonthSpend.csv</strong>: Sales data indicating the average monthly spend of customers, with fields CustomerID and AveMonthSpend.</p></li>
<li><p><strong>AW_BikeBuyer.csv</strong>: Sales data indicating whether a customer has purchased a bike, with fields CustomerID and BikeBuyer.</p></li>
</ol>
</section>
<section id="purpose" class="level3">
<h3 class="anchored" data-anchor-id="purpose">Purpose</h3>
<p>The purpose of this project is to explore the Adventure Works Cycles customer data, build a classification model to predict whether a customer will purchase a bike.</p>
</section>
<section id="workflow-process" class="level3">
<h3 class="anchored" data-anchor-id="workflow-process">Workflow Process</h3>
<ol type="1">
<li><strong>Data Exploration</strong>:
<ul>
<li>Load and inspect the datasets.</li>
<li>Perform exploratory data analysis (EDA) to understand customer characteristics and purchasing behavior.</li>
<li>Visualize relationships between demographic features and purchasing patterns.</li>
</ul></li>
<li><strong>Preprocessing</strong>:
<ul>
<li>Clean and preprocess the data (handle missing values, encode categorical variables, normalize/standardize numerical features).</li>
<li>Merge datasets based on CustomerID to create a unified dataset for analysis.</li>
</ul></li>
<li><strong>Building the Classification Model</strong>:
<ul>
<li>Split the data into training and test sets.</li>
<li>Select appropriate features and target variable (BikeBuyer).</li>
<li>Train a classification model (e.g., logistic regression, decision tree, random forest) to predict bike purchasing behavior.</li>
<li>Optimize the model using cross-validation and hyperparameter tuning.</li>
</ul></li>
<li><strong>Testing the Model</strong>:
<ul>
<li>Evaluate the model’s performance on the test set using metrics such as accuracy, precision, recall, and F1-score.</li>
<li>Analyze the model’s strengths</li>
</ul></li>
</ol>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>This project provides an opportunity to apply machine learning techniques to real-world business data. By analyzing the Adventure Works Cycles customer data, we aim to uncover patterns and make predictions that can help the company better understand their customers and enhance their marketing strategies. The insights gained and models developed will be crucial for making data-driven decisions and improving customer engagement.</p>
</section>
<section id="data-exploration-phase" class="level3">
<h3 class="anchored" data-anchor-id="data-exploration-phase">Data Exploration Phase</h3>
<p>In the data exploration phase, we aim to understand the structure, quality, and key characteristics of our datasets. Here is a description and some basic Python commands to get started with data exploration:</p>
<div id="7c24136f" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load datasets</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>customers <span class="op">=</span> pd.read_csv(<span class="st">'AdvWorksCusts.csv'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>monthly_spend <span class="op">=</span> pd.read_csv(<span class="st">'AW_AveMonthSpend.csv'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>bike_buyer <span class="op">=</span> pd.read_csv(<span class="st">'AW_BikeBuyer.csv'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the first few rows of each dataset</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Customers DataFrame:"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(customers.head())</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Monthly Spend DataFrame:"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_spend.head())</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bike Buyer DataFrame:"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bike_buyer.head())</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate summary statistics for numerical columns</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary Statistics for Customers DataFrame:"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(customers.describe())</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary Statistics for Monthly Spend DataFrame:"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_spend.describe())</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary Statistics for Bike Buyer DataFrame:"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bike_buyer.describe())</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify missing values</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Missing Values in Customers DataFrame:"</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(customers.isnull().<span class="bu">sum</span>())</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Missing Values in Monthly Spend DataFrame:"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_spend.isnull().<span class="bu">sum</span>())</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Missing Values in Bike Buyer DataFrame:"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bike_buyer.isnull().<span class="bu">sum</span>())</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine data types of each column</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data Types in Customers DataFrame:"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(customers.dtypes)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data Types in Monthly Spend DataFrame:"</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_spend.dtypes)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data Types in Bike Buyer DataFrame:"</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bike_buyer.dtypes)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at unique values in categorical columns of Customers DataFrame</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> [<span class="st">'Title'</span>, <span class="st">'Education'</span>, <span class="st">'Occupation'</span>, <span class="st">'Gender'</span>, <span class="st">'MaritalStatus'</span>]</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> categorical_columns:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Unique values in </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> column:"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(customers[column].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Customers DataFrame:
   CustomerID Title  FirstName MiddleName LastName Suffix  \
0       11000   NaN        Jon          V     Yang    NaN   
1       11001   NaN     Eugene          L    Huang    NaN   
2       11002   NaN      Ruben        NaN   Torres    NaN   
3       11003   NaN    Christy        NaN      Zhu    NaN   
4       11004   NaN  Elizabeth        NaN  Johnson    NaN   

          AddressLine1 AddressLine2         City StateProvinceName  ...  \
0      3761 N. 14th St          NaN  Rockhampton        Queensland  ...   
1           2243 W St.          NaN      Seaford          Victoria  ...   
2     5844 Linden Land          NaN       Hobart          Tasmania  ...   
3     1825 Village Pl.          NaN   North Ryde   New South Wales  ...   
4  7553 Harness Circle          NaN   Wollongong   New South Wales  ...   

    BirthDate   Education    Occupation Gender MaritalStatus HomeOwnerFlag  \
0  1966-04-08  Bachelors   Professional      M             M             1   
1  1965-05-14  Bachelors   Professional      M             S             0   
2  1965-08-12  Bachelors   Professional      M             M             1   
3  1968-02-15  Bachelors   Professional      F             S             0   
4  1968-08-08  Bachelors   Professional      F             S             1   

  NumberCarsOwned NumberChildrenAtHome  TotalChildren  YearlyIncome  
0               0                    0              2        137947  
1               1                    3              3        101141  
2               1                    3              3         91945  
3               1                    0              0         86688  
4               4                    5              5         92771  

[5 rows x 23 columns]

Monthly Spend DataFrame:
   CustomerID  AveMonthSpend
0       11000             89
1       11001            117
2       11002            123
3       11003             50
4       11004             95

Bike Buyer DataFrame:
   CustomerID  BikeBuyer
0       11000          0
1       11001          1
2       11002          0
3       11003          0
4       11004          1

Summary Statistics for Customers DataFrame:
         CustomerID  HomeOwnerFlag  NumberCarsOwned  NumberChildrenAtHome  \
count  16519.000000   16519.000000     16519.000000          16519.000000   
mean   20234.225195       0.673891         1.500999              0.992009   
std     5342.515987       0.468802         1.138962              1.515048   
min    11000.000000       0.000000         0.000000              0.000000   
25%    15604.500000       0.000000         1.000000              0.000000   
50%    20221.000000       1.000000         2.000000              0.000000   
75%    24860.500000       1.000000         2.000000              2.000000   
max    29482.000000       1.000000         4.000000              5.000000   

       TotalChildren   YearlyIncome  
count   16519.000000   16519.000000  
mean        2.006235   78122.511532  
std         1.682736   39710.985718  
min         0.000000    9482.000000  
25%         0.000000   47807.500000  
50%         2.000000   76120.000000  
75%         3.000000  105194.500000  
max         5.000000  196511.000000  

Summary Statistics for Monthly Spend DataFrame:
         CustomerID  AveMonthSpend
count  16519.000000   16519.000000
mean   20234.225195      72.405957
std     5342.515987      27.285370
min    11000.000000      22.000000
25%    15604.500000      52.000000
50%    20221.000000      68.000000
75%    24860.500000      84.000000
max    29482.000000     176.000000

Summary Statistics for Bike Buyer DataFrame:
         CustomerID     BikeBuyer
count  16519.000000  16519.000000
mean   20234.225195      0.332284
std     5342.515987      0.471046
min    11000.000000      0.000000
25%    15604.500000      0.000000
50%    20221.000000      0.000000
75%    24860.500000      1.000000
max    29482.000000      1.000000

Missing Values in Customers DataFrame:
CustomerID                  0
Title                   16431
FirstName                   0
MiddleName               6985
LastName                    0
Suffix                  16517
AddressLine1                0
AddressLine2            16243
City                        0
StateProvinceName           0
CountryRegionName           0
PostalCode                  0
PhoneNumber                 0
BirthDate                   0
Education                   0
Occupation                  0
Gender                      0
MaritalStatus               0
HomeOwnerFlag               0
NumberCarsOwned             0
NumberChildrenAtHome        0
TotalChildren               0
YearlyIncome                0
dtype: int64

Missing Values in Monthly Spend DataFrame:
CustomerID       0
AveMonthSpend    0
dtype: int64

Missing Values in Bike Buyer DataFrame:
CustomerID    0
BikeBuyer     0
dtype: int64

Data Types in Customers DataFrame:
CustomerID               int64
Title                   object
FirstName               object
MiddleName              object
LastName                object
Suffix                  object
AddressLine1            object
AddressLine2            object
City                    object
StateProvinceName       object
CountryRegionName       object
PostalCode              object
PhoneNumber             object
BirthDate               object
Education               object
Occupation              object
Gender                  object
MaritalStatus           object
HomeOwnerFlag            int64
NumberCarsOwned          int64
NumberChildrenAtHome     int64
TotalChildren            int64
YearlyIncome             int64
dtype: object

Data Types in Monthly Spend DataFrame:
CustomerID       int64
AveMonthSpend    int64
dtype: object

Data Types in Bike Buyer DataFrame:
CustomerID    int64
BikeBuyer     int64
dtype: object

Unique values in Title column:
[nan 'Ms.' 'Mr.' 'Mrs.' 'Sr.' 'Ms']

Unique values in Education column:
['Bachelors ' 'Partial College' 'High School' 'Partial High School'
 'Graduate Degree']

Unique values in Occupation column:
['Professional' 'Management' 'Skilled Manual' 'Clerical' 'Manual']

Unique values in Gender column:
['M' 'F']

Unique values in MaritalStatus column:
['M' 'S']</code></pre>
</div>
</div>
</section>
<section id="description-of-the-code" class="level3">
<h3 class="anchored" data-anchor-id="description-of-the-code">Description of the Code</h3>
<ol type="1">
<li><strong>Import Libraries</strong>: Import the pandas library for data manipulation.</li>
<li><strong>Load Data</strong>: Load the three datasets (<code>AdvWorksCusts.csv</code>, <code>AW_AveMonthSpend.csv</code>, and <code>AW_BikeBuyer.csv</code>) into pandas DataFrames.</li>
<li><strong>Inspect Data</strong>: Print the first few rows of each DataFrame to understand the data structure.</li>
<li><strong>Summary Statistics</strong>: Use the <code>describe</code> method to get summary statistics for the numerical columns in each DataFrame.</li>
<li><strong>Missing Values</strong>: Use the <code>isnull</code> method combined with <code>sum</code> to identify missing values in each DataFrame.</li>
<li><strong>Data Types</strong>: Use the <code>dtypes</code> attribute to examine the data types of each column in the DataFrames.</li>
<li><strong>Unique Values</strong>: For categorical columns in the <code>customers</code> DataFrame, use the <code>unique</code> method to display the unique values.</li>
</ol>
<p>By performing these steps, we gain a comprehensive understanding of the datasets, which is essential for the subsequent preprocessing and model building phases.</p>
<p>In addition to the basic exploration commands, visualizing relationships between variables can provide valuable insights, especially for classification tasks. Here, we will use the <code>matplotlib</code> and <code>seaborn</code> libraries to create plots that help us understand the relationships between various categories.</p>
<div id="b8524969" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load datasets</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>customers <span class="op">=</span> pd.read_csv(<span class="st">'AdvWorksCusts.csv'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>monthly_spend <span class="op">=</span> pd.read_csv(<span class="st">'AW_AveMonthSpend.csv'</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>bike_buyer <span class="op">=</span> pd.read_csv(<span class="st">'AW_BikeBuyer.csv'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on CustomerID</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.merge(customers, bike_buyer, on<span class="op">=</span><span class="st">'CustomerID'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the first few rows of the merged dataset</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Merged DataFrame:"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.head())</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of the target variable (BikeBuyer)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>data, x<span class="op">=</span><span class="st">'BikeBuyer'</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Bike Buyer'</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Bike Buyer'</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot count plots for categorical variables</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> [<span class="st">'Education'</span>, <span class="st">'Occupation'</span>, <span class="st">'Gender'</span>, <span class="st">'MaritalStatus'</span>]</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> categorical_columns:</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>data, x<span class="op">=</span>column, hue<span class="op">=</span><span class="st">'BikeBuyer'</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Count Plot of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> by Bike Buyer'</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(column)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">'Bike Buyer'</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert BirthDate to Age</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BirthDate'</span>] <span class="op">=</span> pd.to_datetime(data[<span class="st">'BirthDate'</span>])</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Age'</span>] <span class="op">=</span> <span class="dv">1998</span> <span class="op">-</span> data[<span class="st">'BirthDate'</span>].dt.year</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot box plots for numerical vs. categorical variables</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>numerical_columns <span class="op">=</span> [<span class="st">'YearlyIncome'</span>, <span class="st">'Age'</span>]</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> numerical_columns:</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>data, x<span class="op">=</span><span class="st">'BikeBuyer'</span>, y<span class="op">=</span>column)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Box Plot of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> by Bike Buyer'</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Bike Buyer'</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(column)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a correlation heatmap</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> data[[<span class="st">'YearlyIncome'</span>, <span class="st">'Age'</span>, <span class="st">'NumberCarsOwned'</span>, <span class="st">'NumberChildrenAtHome'</span>, <span class="st">'TotalChildren'</span>, <span class="st">'BikeBuyer'</span>]].corr()</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Correlation Heatmap'</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merged DataFrame:
   CustomerID Title  FirstName MiddleName LastName Suffix  \
0       11000   NaN        Jon          V     Yang    NaN   
1       11001   NaN     Eugene          L    Huang    NaN   
2       11002   NaN      Ruben        NaN   Torres    NaN   
3       11003   NaN    Christy        NaN      Zhu    NaN   
4       11004   NaN  Elizabeth        NaN  Johnson    NaN   

          AddressLine1 AddressLine2         City StateProvinceName  ...  \
0      3761 N. 14th St          NaN  Rockhampton        Queensland  ...   
1           2243 W St.          NaN      Seaford          Victoria  ...   
2     5844 Linden Land          NaN       Hobart          Tasmania  ...   
3     1825 Village Pl.          NaN   North Ryde   New South Wales  ...   
4  7553 Harness Circle          NaN   Wollongong   New South Wales  ...   

    Education    Occupation Gender MaritalStatus HomeOwnerFlag  \
0  Bachelors   Professional      M             M             1   
1  Bachelors   Professional      M             S             0   
2  Bachelors   Professional      M             M             1   
3  Bachelors   Professional      F             S             0   
4  Bachelors   Professional      F             S             1   

  NumberCarsOwned NumberChildrenAtHome TotalChildren  YearlyIncome  BikeBuyer  
0               0                    0             2        137947          0  
1               1                    3             3        101141          1  
2               1                    3             3         91945          0  
3               1                    0             0         86688          0  
4               4                    5             5         92771          1  

[5 rows x 24 columns]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-2.png" width="684" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-3.png" width="825" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-4.png" width="825" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-5.png" width="825" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-6.png" width="825" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-7.png" width="842" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-8.png" width="808" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-3-output-9.png" width="1029" height="802" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="description-of-the-code-1" class="level3">
<h3 class="anchored" data-anchor-id="description-of-the-code-1">Description of the Code</h3>
<ol type="1">
<li><strong>Import Libraries for Plotting</strong>: Import <code>matplotlib.pyplot</code> for basic plotting and <code>seaborn</code> for advanced visualization.</li>
<li><strong>Merge Datasets</strong>: Merge the <code>customers</code> and <code>bike_buyer</code> DataFrames on <code>CustomerID</code> to create a consolidated dataset for analysis.</li>
<li><strong>Distribution of Target Variable</strong>: Use <code>sns.countplot</code> to visualize the distribution of the <code>BikeBuyer</code> variable.</li>
<li><strong>Count Plots for Categorical Variables</strong>: For each categorical column in <code>Education</code>, <code>Occupation</code>, <code>Gender</code>, and <code>MaritalStatus</code>, use <code>sns.countplot</code> to plot the counts of categories, separated by the <code>BikeBuyer</code> variable.</li>
<li><strong>Convert BirthDate to Age</strong>: Calculate the <code>Age</code> of each customer from their <code>BirthDate</code>.</li>
<li><strong>Box Plots for Numerical vs.&nbsp;Categorical Variables</strong>: For each numerical column in <code>YearlyIncome</code> and <code>Age</code>, use <code>sns.boxplot</code> to visualize the distribution of values, separated by the <code>BikeBuyer</code> variable.</li>
<li><strong>Correlation Heatmap</strong>: Use <code>sns.heatmap</code> to visualize the correlation between numerical features, including the target variable <code>BikeBuyer</code>.</li>
</ol>
<p>These visualizations help in understanding the relationships between features and the target variable, aiding in the feature selection and model building processes.</p>
</section>
<section id="data-preprocessing-phase" class="level3">
<h3 class="anchored" data-anchor-id="data-preprocessing-phase">Data Preprocessing Phase</h3>
<p>In this phase, we will clean and preprocess the data to prepare it for model building. Here is a description and the code for the preprocessing steps:</p>
<div id="87db9a9b" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, date</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable inline plotting</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load datasets</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>AdvWorksCusts <span class="op">=</span> pd.read_csv(<span class="st">'AdvWorksCusts.csv'</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>AW_BikeBuyer <span class="op">=</span> pd.read_csv(<span class="st">'AW_BikeBuyer.csv'</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>AW_AveMonthSpend <span class="op">=</span> pd.read_csv(<span class="st">'AW_AveMonthSpend.csv'</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicates</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>AdvWorksCusts.drop_duplicates(subset<span class="op">=</span>[<span class="st">'CustomerID'</span>], keep<span class="op">=</span><span class="st">'first'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>AW_BikeBuyer.drop_duplicates(subset<span class="op">=</span>[<span class="st">'CustomerID'</span>], keep<span class="op">=</span><span class="st">'first'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>AW_AveMonthSpend.drop_duplicates(subset<span class="op">=</span>[<span class="st">'CustomerID'</span>], keep<span class="op">=</span><span class="st">'first'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on CustomerID</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(AdvWorksCusts, AW_AveMonthSpend, on<span class="op">=</span><span class="st">'CustomerID'</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(df, AW_BikeBuyer, on<span class="op">=</span><span class="st">'CustomerID'</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the shape of the merged DataFrame</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">'Title'</span>, <span class="st">'FirstName'</span>, <span class="st">'LastName'</span>, <span class="st">'MiddleName'</span>, <span class="st">'Suffix'</span>, <span class="st">'AddressLine1'</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">'AddressLine2'</span>, <span class="st">'PhoneNumber'</span>, <span class="st">'City'</span>, <span class="st">'PostalCode'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data types</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to count unique values in categorical columns</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_unique(df, cols):</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> cols:</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="op">+</span> <span class="st">'For column '</span> <span class="op">+</span> col)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(df[col].value_counts())</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">'Education'</span>, <span class="st">'Occupation'</span>, <span class="st">'Gender'</span>, <span class="st">'CountryRegionName'</span>, <span class="st">'MaritalStatus'</span>, <span class="st">'BikeBuyer'</span>, <span class="st">'HomeOwnerFlag'</span>]</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>count_unique(df, cat_cols)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert BirthDate to Age</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'BirthDate'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'BirthDate'</span>])</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Coll_date'</span>] <span class="op">=</span> pd.to_datetime(date(year<span class="op">=</span><span class="dv">1998</span>, month<span class="op">=</span><span class="dv">1</span>, day<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Age'</span>] <span class="op">=</span> (df[<span class="st">'Coll_date'</span>] <span class="op">-</span> df[<span class="st">'BirthDate'</span>]).dt.days <span class="op">//</span> <span class="dv">365</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop intermediate columns used for age calculation</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">'Coll_date'</span>, <span class="st">'BirthDate'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Age'</span>] <span class="op">=</span> df[<span class="st">'Age'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age ranges</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AgeRange'</span>] <span class="op">=</span> [<span class="st">'Under 25'</span> <span class="cf">if</span> (x <span class="op">&lt;</span> <span class="dv">25</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">else</span> <span class="st">'Between 25 and 45'</span> <span class="cf">if</span> (<span class="dv">25</span> <span class="op">&lt;=</span> x <span class="op">&lt;=</span> <span class="dv">45</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">else</span> <span class="st">'Between 45 and 55'</span> <span class="cf">if</span> (<span class="dv">45</span> <span class="op">&lt;</span> x <span class="op">&lt;=</span> <span class="dv">55</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">else</span> <span class="st">'Over 55'</span> <span class="cf">for</span> x <span class="kw">in</span> df[<span class="st">'Age'</span>]]</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AgeRange'</span>].value_counts().plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Age Range Distribution'</span>)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Age Range'</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns to categorical data types</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'CountryRegionName'</span>] <span class="op">=</span> df[<span class="st">'CountryRegionName'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Education'</span>] <span class="op">=</span> df[<span class="st">'Education'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Occupation'</span>] <span class="op">=</span> df[<span class="st">'Occupation'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Gender'</span>] <span class="op">=</span> df[<span class="st">'Gender'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MaritalStatus'</span>] <span class="op">=</span> df[<span class="st">'MaritalStatus'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AgeRange'</span>] <span class="op">=</span> df[<span class="st">'AgeRange'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'BikeBuyer'</span>] <span class="op">=</span> df[<span class="st">'BikeBuyer'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'HomeOwnerFlag'</span>] <span class="op">=</span> df[<span class="st">'HomeOwnerFlag'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data types again</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Log transform the YearlyIncome column</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'log_YearlyIncome'</span>] <span class="op">=</span> np.log(df[<span class="st">'YearlyIncome'</span>])</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop irrelevant columns</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">'NumberChildrenAtHome'</span>, <span class="st">'Age'</span>, <span class="st">'AveMonthSpend'</span>, <span class="st">'HomeOwnerFlag'</span>, <span class="st">'YearlyIncome'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Print DataFrame info</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the processed DataFrame to a CSV file</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'Class_BikeBuyer.csv'</span>, index<span class="op">=</span><span class="va">False</span>, header<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(16404, 25)
CustomerID               int64
StateProvinceName       object
CountryRegionName       object
BirthDate               object
Education               object
Occupation              object
Gender                  object
MaritalStatus           object
HomeOwnerFlag            int64
NumberCarsOwned          int64
NumberChildrenAtHome     int64
TotalChildren            int64
YearlyIncome             int64
AveMonthSpend            int64
BikeBuyer                int64
dtype: object

For column Education
Education
Bachelors              4758
Partial College        4451
High School            2944
Graduate Degree        2851
Partial High School    1400
Name: count, dtype: int64

For column Occupation
Occupation
Professional      4922
Skilled Manual    4038
Management        2718
Clerical          2597
Manual            2129
Name: count, dtype: int64

For column Gender
Gender
M    8290
F    8114
Name: count, dtype: int64

For column CountryRegionName
CountryRegionName
United States     6935
Australia         3194
United Kingdom    1709
France            1591
Germany           1577
Canada            1398
Name: count, dtype: int64

For column MaritalStatus
MaritalStatus
M    8852
S    7552
Name: count, dtype: int64

For column BikeBuyer
BikeBuyer
0    10953
1     5451
Name: count, dtype: int64

For column HomeOwnerFlag
HomeOwnerFlag
1    11058
0     5346
Name: count, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cell-4-output-2.png" width="610" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CustomerID                 int64
StateProvinceName         object
CountryRegionName       category
Education               category
Occupation              category
Gender                  category
MaritalStatus           category
HomeOwnerFlag           category
NumberCarsOwned            int64
NumberChildrenAtHome       int64
TotalChildren              int64
YearlyIncome               int64
AveMonthSpend              int64
BikeBuyer               category
Age                        int64
AgeRange                category
dtype: object
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 16404 entries, 0 to 16403
Data columns (total 12 columns):
 #   Column             Non-Null Count  Dtype   
---  ------             --------------  -----   
 0   CustomerID         16404 non-null  int64   
 1   StateProvinceName  16404 non-null  object  
 2   CountryRegionName  16404 non-null  category
 3   Education          16404 non-null  category
 4   Occupation         16404 non-null  category
 5   Gender             16404 non-null  category
 6   MaritalStatus      16404 non-null  category
 7   NumberCarsOwned    16404 non-null  int64   
 8   TotalChildren      16404 non-null  int64   
 9   BikeBuyer          16404 non-null  category
 10  AgeRange           16404 non-null  category
 11  log_YearlyIncome   16404 non-null  float64 
dtypes: category(7), float64(1), int64(3), object(1)
memory usage: 754.2+ KB</code></pre>
</div>
</div>
</section>
<section id="description-of-the-code-2" class="level3">
<h3 class="anchored" data-anchor-id="description-of-the-code-2">Description of the Code</h3>
<ol type="1">
<li><strong>Import Libraries</strong>: Import the required libraries for data manipulation and visualization.</li>
<li><strong>Load Data</strong>: Load the three datasets into pandas DataFrames.</li>
<li><strong>Remove Duplicates</strong>: Ensure there are no duplicate entries in the datasets by removing duplicates based on <code>CustomerID</code>.</li>
<li><strong>Merge Data</strong>: Combine the datasets into a single DataFrame using <code>CustomerID</code>.</li>
<li><strong>Drop Unnecessary Columns</strong>: Remove columns that are not useful for the analysis, such as name and address details.</li>
<li><strong>Inspect Data Types</strong>: Print the data types of each column to ensure they are appropriate.</li>
<li><strong>Count Unique Values</strong>: Define a function to count and print the unique values for categorical columns.</li>
<li><strong>Convert BirthDate to Age</strong>: Calculate the age of customers from their birth dates by subtracting from a fixed collection date.</li>
<li><strong>Create Age Ranges</strong>: Categorize the age values into ranges for better analysis and visualization.</li>
<li><strong>Convert to Categorical Data Types</strong>: Convert relevant columns to the categorical data type for efficient storage and processing.</li>
<li><strong>Log Transformation</strong>: Apply a log transformation to the <code>YearlyIncome</code> column to normalize the distribution.</li>
<li><strong>Drop Irrelevant Columns</strong>: Remove columns that are not needed for the classification model.</li>
<li><strong>Save Processed Data</strong>: Save the cleaned and processed DataFrame to a CSV file for future use.</li>
</ol>
<p>This preprocessing ensures that the data is clean, well-structured, and ready for building the classification model in the next phase.</p>
</section>
<section id="preparing-the-test-data-for-classification" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-test-data-for-classification">Preparing the Test Data for Classification</h3>
<p>In this phase, we will prepare the test dataset for classification by performing similar preprocessing steps as we did for the training dataset. This includes cleaning the data, calculating the age, and creating categorical variables. Here’s the code to accomplish this:</p>
<div id="16e92a33" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the test dataset</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>AW_test <span class="op">=</span> pd.read_csv(<span class="st">'AW_test.csv'</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the test dataset</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(AW_test.head())</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>AW_test.drop([<span class="st">'Title'</span>, <span class="st">'FirstName'</span>, <span class="st">'LastName'</span>, <span class="st">'MiddleName'</span>, <span class="st">'Suffix'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">'AddressLine1'</span>, <span class="st">'AddressLine2'</span>, <span class="st">'StateProvinceName'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">'PhoneNumber'</span>, <span class="st">'City'</span>, <span class="st">'PostalCode'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data types</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(AW_test.dtypes)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert BirthDate to Age</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>AW_test[<span class="st">'BirthDate'</span>] <span class="op">=</span> pd.to_datetime(AW_test[<span class="st">'BirthDate'</span>])</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>AW_test[<span class="st">'Coll_date'</span>] <span class="op">=</span> pd.to_datetime(date(year<span class="op">=</span><span class="dv">1998</span>, month<span class="op">=</span><span class="dv">1</span>, day<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>AW_test[<span class="st">'Age'</span>] <span class="op">=</span> (AW_test[<span class="st">'Coll_date'</span>] <span class="op">-</span> AW_test[<span class="st">'BirthDate'</span>]).dt.days <span class="op">//</span> <span class="dv">365</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop intermediate columns used for age calculation</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>AW_test.drop([<span class="st">'Coll_date'</span>, <span class="st">'BirthDate'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>AW_test[<span class="st">'Age'</span>] <span class="op">=</span> AW_test[<span class="st">'Age'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age ranges</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>AW_test[<span class="st">'AgeRange'</span>] <span class="op">=</span> [<span class="st">'Under 25'</span> <span class="cf">if</span> (x <span class="op">&lt;</span> <span class="dv">25</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">else</span> <span class="st">'Between 25 and 45'</span> <span class="cf">if</span> (<span class="dv">25</span> <span class="op">&lt;=</span> x <span class="op">&lt;=</span> <span class="dv">45</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">else</span> <span class="st">'Between 45 and 55'</span> <span class="cf">if</span> (<span class="dv">45</span> <span class="op">&lt;</span> x <span class="op">&lt;=</span> <span class="dv">55</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">else</span> <span class="st">'Over 55'</span> <span class="cf">for</span> x <span class="kw">in</span> AW_test[<span class="st">'Age'</span>]]</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Log transform the YearlyIncome column</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>AW_test[<span class="st">'log_YearlyIncome'</span>] <span class="op">=</span> np.log(AW_test[<span class="st">'YearlyIncome'</span>])</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop irrelevant columns</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>AW_test.drop([<span class="st">'NumberChildrenAtHome'</span>, <span class="st">'Age'</span>, <span class="st">'HomeOwnerFlag'</span>, <span class="st">'YearlyIncome'</span>],</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>              axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Print DataFrame info to verify preprocessing</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(AW_test.info())</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the preprocessed test DataFrame to a CSV file</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>AW_test.to_csv(<span class="st">'AW_Test_prepped_classification.csv'</span>, index<span class="op">=</span><span class="va">False</span>, header<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   CustomerID Title FirstName MiddleName  LastName Suffix  \
0       18988   NaN  Courtney          A     Baker    NaN   
1       29135   NaN      Adam          C     Allen    NaN   
2       12156   NaN    Bonnie        NaN      Raji    NaN   
3       13749   NaN     Julio          C    Alonso    NaN   
4       27780   NaN   Christy          A  Andersen    NaN   

             AddressLine1 AddressLine2        City StateProvinceName  ...  \
0   8727 Buena Vista Ave.          NaN     Fremont        California  ...   
1        3491 Cook Street          NaN       Haney  British Columbia  ...   
2    359 Pleasant Hill Rd          NaN     Burbank        California  ...   
3        8945 Euclid Ave.          NaN  Burlingame        California  ...   
4  42, boulevard Tremblay          NaN   Dunkerque              Nord  ...   

   BirthDate        Education      Occupation Gender MaritalStatus  \
0   1/5/1945       Bachelors       Management      F             S   
1  10/4/1964       Bachelors   Skilled Manual      M             M   
2  1/12/1934  Graduate Degree      Management      F             M   
3  9/22/1958  Graduate Degree  Skilled Manual      M             M   
4  3/19/1965      High School          Manual      F             M   

  HomeOwnerFlag NumberCarsOwned NumberChildrenAtHome  TotalChildren  \
0             0               2                    0              5   
1             1               2                    2              4   
2             1               2                    0              4   
3             1               0                    0              4   
4             1               1                    2              2   

   YearlyIncome  
0         86931  
1        100125  
2        103985  
3        127161  
4         21876  

[5 rows x 23 columns]
CustomerID               int64
CountryRegionName       object
BirthDate               object
Education               object
Occupation              object
Gender                  object
MaritalStatus           object
HomeOwnerFlag            int64
NumberCarsOwned          int64
NumberChildrenAtHome     int64
TotalChildren            int64
YearlyIncome             int64
dtype: object
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 500 entries, 0 to 499
Data columns (total 10 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   CustomerID         500 non-null    int64  
 1   CountryRegionName  500 non-null    object 
 2   Education          500 non-null    object 
 3   Occupation         500 non-null    object 
 4   Gender             500 non-null    object 
 5   MaritalStatus      500 non-null    object 
 6   NumberCarsOwned    500 non-null    int64  
 7   TotalChildren      500 non-null    int64  
 8   AgeRange           500 non-null    object 
 9   log_YearlyIncome   500 non-null    float64
dtypes: float64(1), int64(3), object(6)
memory usage: 39.2+ KB
None</code></pre>
</div>
</div>
</section>
<section id="summary-of-key-steps-in-the-code" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-key-steps-in-the-code">Summary of Key Steps in the Code</h3>
<ul>
<li><strong>Load Test Dataset</strong>: Load the test dataset using <code>pd.read_csv()</code>.</li>
<li><strong>Drop Unnecessary Columns</strong>: Remove columns that do not contribute to the classification task.</li>
<li><strong>Convert BirthDate to Age</strong>: Calculate the age of each customer and drop unnecessary columns.</li>
<li><strong>Create Age Ranges</strong>: Classify customers into age ranges for better analysis.</li>
<li><strong>Log Transformation</strong>: Apply a log transformation to the <code>YearlyIncome</code> column to normalize its distribution.</li>
<li><strong>Drop Irrelevant Columns</strong>: Remove columns that are not needed for the classification model.</li>
<li><strong>Save Preprocessed Data</strong>: Save the cleaned test DataFrame to a CSV file for use in the classification model.</li>
</ul>
<p>This prepares the test data in the same way as the training data, ensuring consistency and allowing for accurate predictions using the classification model.</p>
</section>
<section id="model-building-phase" class="level3">
<h3 class="anchored" data-anchor-id="model-building-phase">Model Building Phase</h3>
<p>In this phase, we will build a classification model using both logistic regression and random forest. This includes encoding categorical features, scaling numerical features, splitting the data into training and testing sets, training the models, and evaluating their performance. Finally, we will save the trained models for future use.</p>
<div id="2265fedd" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.model_selection <span class="im">as</span> ms</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> feature_selection <span class="im">as</span> fs</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.metrics <span class="im">as</span> sklm</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Class_BikeBuyer.csv'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the labels</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> np.array(df[<span class="st">'BikeBuyer'</span>])</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to encode categorical string features</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_string(cat_features):</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    enc <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    enc.fit(cat_features)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    enc_cat_features <span class="op">=</span> enc.transform(cat_features)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    ohe <span class="op">=</span> preprocessing.OneHotEncoder()</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    encoded <span class="op">=</span> ohe.fit(enc_cat_features.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> encoded.transform(enc_cat_features.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).toarray()</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># List of categorical columns</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> [<span class="st">'Education'</span>, <span class="st">'Occupation'</span>, <span class="st">'Gender'</span>, <span class="st">'MaritalStatus'</span>, <span class="st">'AgeRange'</span>]</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>Features <span class="op">=</span> encode_string(df[<span class="st">'CountryRegionName'</span>])</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> categorical_columns:</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> encode_string(df[col])</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    Features <span class="op">=</span> np.concatenate([Features, temp], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Add numerical features</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>Features <span class="op">=</span> np.concatenate([Features, np.array(df[[<span class="st">'NumberCarsOwned'</span>, <span class="st">'TotalChildren'</span>, <span class="st">'log_YearlyIncome'</span>]])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>indx <span class="op">=</span> ms.train_test_split(<span class="bu">range</span>(Features.shape[<span class="dv">0</span>]), test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> Features[indx[<span class="dv">0</span>], :]</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.ravel(labels[indx[<span class="dv">0</span>]])</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> Features[indx[<span class="dv">1</span>], :]</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> np.ravel(labels[indx[<span class="dv">1</span>]])</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the numerical features</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> preprocessing.StandardScaler().fit(X_train[:, <span class="dv">25</span>:])</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>X_train[:, <span class="dv">25</span>:] <span class="op">=</span> scaler.transform(X_train[:, <span class="dv">25</span>:])</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>X_test[:, <span class="dv">25</span>:] <span class="op">=</span> scaler.transform(X_test[:, <span class="dv">25</span>:])</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic Regression Model</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>logistic_mod <span class="op">=</span> linear_model.LogisticRegression()</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>logistic_mod.fit(X_train, y_train)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>logistic_probabilities <span class="op">=</span> logistic_mod.predict_proba(X_test)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest Model</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>random_forest_mod <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>random_forest_mod.fit(X_train, y_train)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>random_forest_probabilities <span class="op">=</span> random_forest_mod.predict_proba(X_test)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to score the model based on a threshold</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_model(probs, threshold):</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([<span class="dv">1</span> <span class="cf">if</span> x <span class="op">&gt;</span> threshold <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> x <span class="kw">in</span> probs[:, <span class="dv">1</span>]])</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic Regression Scores</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>logistic_scores <span class="op">=</span> score_model(logistic_probabilities, <span class="fl">0.5</span>)</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest Scores</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>random_forest_scores <span class="op">=</span> score_model(random_forest_probabilities, <span class="fl">0.5</span>)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to print metrics</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_metrics(labels, scores):</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    metrics <span class="op">=</span> sklm.precision_recall_fscore_support(labels, scores)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    conf <span class="op">=</span> sklm.confusion_matrix(labels, scores)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'                 Confusion matrix'</span>)</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'                 Score positive    Score negative'</span>)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Actual positive    </span><span class="sc">%6d</span><span class="st">'</span> <span class="op">%</span> conf[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">+</span> <span class="st">'             </span><span class="sc">%5d</span><span class="st">'</span> <span class="op">%</span> conf[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Actual negative    </span><span class="sc">%6d</span><span class="st">'</span> <span class="op">%</span> conf[<span class="dv">1</span>, <span class="dv">0</span>] <span class="op">+</span> <span class="st">'             </span><span class="sc">%5d</span><span class="st">'</span> <span class="op">%</span> conf[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">''</span>)</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Accuracy  </span><span class="sc">%0.2f</span><span class="st">'</span> <span class="op">%</span> sklm.accuracy_score(labels, scores))</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">' '</span>)</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'           Positive      Negative'</span>)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Num case   </span><span class="sc">%6d</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">3</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="st">'        </span><span class="sc">%6d</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">3</span>][<span class="dv">1</span>])</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Precision  </span><span class="sc">%6.2f</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="st">'        </span><span class="sc">%6.2f</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">0</span>][<span class="dv">1</span>])</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Recall     </span><span class="sc">%6.2f</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">1</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="st">'        </span><span class="sc">%6.2f</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">1</span>][<span class="dv">1</span>])</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'F1         </span><span class="sc">%6.2f</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">2</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="st">'        </span><span class="sc">%6.2f</span><span class="st">'</span> <span class="op">%</span> metrics[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Print metrics for Logistic Regression</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Logistic Regression Metrics:"</span>)</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>print_metrics(y_test, logistic_scores)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Print metrics for Random Forest</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Random Forest Metrics:"</span>)</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>print_metrics(y_test, random_forest_scores)</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the models</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>pickle.dump(logistic_mod, <span class="bu">open</span>(<span class="st">'logistic_classification_model.sav'</span>, <span class="st">'wb'</span>))</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>pickle.dump(random_forest_mod, <span class="bu">open</span>(<span class="st">'random_forest_classification_model.sav'</span>, <span class="st">'wb'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 16404 entries, 0 to 16403
Data columns (total 12 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   CustomerID         16404 non-null  int64  
 1   StateProvinceName  16404 non-null  object 
 2   CountryRegionName  16404 non-null  object 
 3   Education          16404 non-null  object 
 4   Occupation         16404 non-null  object 
 5   Gender             16404 non-null  object 
 6   MaritalStatus      16404 non-null  object 
 7   NumberCarsOwned    16404 non-null  int64  
 8   TotalChildren      16404 non-null  int64  
 9   BikeBuyer          16404 non-null  int64  
 10  AgeRange           16404 non-null  object 
 11  log_YearlyIncome   16404 non-null  float64
dtypes: float64(1), int64(4), object(7)
memory usage: 1.5+ MB
Logistic Regression Metrics:
                 Confusion matrix
                 Score positive    Score negative
Actual positive      1937               284
Actual negative       509               551

Accuracy  0.76
 
           Positive      Negative
Num case     2221          1060
Precision    0.79          0.66
Recall       0.87          0.52
F1           0.83          0.58

Random Forest Metrics:
                 Confusion matrix
                 Score positive    Score negative
Actual positive      1789               432
Actual negative       435               625

Accuracy  0.74
 
           Positive      Negative
Num case     2221          1060
Precision    0.80          0.59
Recall       0.81          0.59
F1           0.80          0.59</code></pre>
</div>
</div>
</section>
<section id="description-of-key-steps-in-the-code" class="level3">
<h3 class="anchored" data-anchor-id="description-of-key-steps-in-the-code">Description of Key Steps in the Code</h3>
<ul>
<li><strong>Import Libraries</strong>: Import the necessary libraries for data manipulation, model building, and evaluation.</li>
<li><strong>Load Dataset</strong>: Load the preprocessed dataset.</li>
<li><strong>Extract Labels</strong>: Extract the target labels (<code>BikeBuyer</code>) from the dataset.</li>
<li><strong>Encode Categorical Features</strong>: Encode categorical features using label encoding and one-hot encoding.</li>
<li><strong>Add Numerical Features</strong>: Add numerical features to the feature set.</li>
<li><strong>Split Data</strong>: Split the data into training and testing sets.</li>
<li><strong>Scale Numerical Features</strong>: Standardize the numerical features.</li>
<li><strong>Logistic Regression Model</strong>: Train a logistic regression model and predict probabilities.</li>
<li><strong>Random Forest Model</strong>: Train a random forest model and predict probabilities.</li>
<li><strong>Score Model</strong>: Define a function to score the model based on a probability threshold.</li>
<li><strong>Print Metrics</strong>: Define a function to print evaluation metrics and confusion matrix.</li>
<li><strong>Save Models</strong>: Save the trained logistic regression and random forest models using pickle.</li>
</ul>
<p>By including both logistic regression and random forest models, we can compare their performance and choose the best model for our classification task.</p>
</section>
<section id="preparing-the-test-data-for-classification-1" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-test-data-for-classification-1">Preparing the Test Data for Classification</h3>
<p>In this phase, we will prepare the test data by encoding categorical features, scaling numerical features, and using the trained logistic regression model to make predictions on the test data. Finally, we will save the predictions to a CSV file.</p>
<div id="5bec098b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the trained models</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>logistic_model <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'logistic_classification_model.sav'</span>, <span class="st">'rb'</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>random_forest_model <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'random_forest_classification_model.sav'</span>, <span class="st">'rb'</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the test dataset</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'AW_Test_prepped_classification.csv'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>df.info()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to encode categorical string features</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_string(cat_features):</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    enc <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    enc.fit(cat_features)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    enc_cat_features <span class="op">=</span> enc.transform(cat_features)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    ohe <span class="op">=</span> preprocessing.OneHotEncoder()</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    encoded <span class="op">=</span> ohe.fit(enc_cat_features.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> encoded.transform(enc_cat_features.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).toarray()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># List of categorical columns</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> [<span class="st">'Education'</span>, <span class="st">'Occupation'</span>, <span class="st">'Gender'</span>, <span class="st">'MaritalStatus'</span>, <span class="st">'AgeRange'</span>]</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>Features <span class="op">=</span> encode_string(df[<span class="st">'CountryRegionName'</span>])</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> categorical_columns:</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> encode_string(df[col])</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    Features <span class="op">=</span> np.concatenate([Features, temp], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Add numerical features</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>Features <span class="op">=</span> np.concatenate([Features, np.array(df[[<span class="st">'NumberCarsOwned'</span>, <span class="st">'TotalChildren'</span>, <span class="st">'log_YearlyIncome'</span>]])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the numerical features</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> preprocessing.StandardScaler().fit(Features[:, <span class="dv">25</span>:])</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>Features[:, <span class="dv">25</span>:] <span class="op">=</span> scaler.transform(Features[:, <span class="dv">25</span>:])</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions with logistic regression</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>logistic_class_pred <span class="op">=</span> pd.DataFrame(logistic_model.predict(Features))</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>logistic_class_pred.rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'LogisticPredBikeBuyer'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>logistic_class_pred[<span class="st">'CustomerID'</span>] <span class="op">=</span> df[<span class="st">'CustomerID'</span>]</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions with random forest</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>random_forest_class_pred <span class="op">=</span> pd.DataFrame(random_forest_model.predict(Features))</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>random_forest_class_pred.rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'RandomForestPredBikeBuyer'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>random_forest_class_pred[<span class="st">'CustomerID'</span>] <span class="op">=</span> df[<span class="st">'CustomerID'</span>]</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the predictions</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>combined_class_pred <span class="op">=</span> logistic_class_pred.merge(random_forest_class_pred, on<span class="op">=</span><span class="st">'CustomerID'</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>combined_class_pred <span class="op">=</span> combined_class_pred[[<span class="st">'CustomerID'</span>, <span class="st">'LogisticPredBikeBuyer'</span>, <span class="st">'RandomForestPredBikeBuyer'</span>]]</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the combined predictions to a CSV file</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>combined_class_pred.to_csv(<span class="st">'CombinedClassPred.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 500 entries, 0 to 499
Data columns (total 10 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   CustomerID         500 non-null    int64  
 1   CountryRegionName  500 non-null    object 
 2   Education          500 non-null    object 
 3   Occupation         500 non-null    object 
 4   Gender             500 non-null    object 
 5   MaritalStatus      500 non-null    object 
 6   NumberCarsOwned    500 non-null    int64  
 7   TotalChildren      500 non-null    int64  
 8   AgeRange           500 non-null    object 
 9   log_YearlyIncome   500 non-null    float64
dtypes: float64(1), int64(3), object(6)
memory usage: 39.2+ KB</code></pre>
</div>
</div>
</section>
<section id="description-of-key-steps" class="level3">
<h3 class="anchored" data-anchor-id="description-of-key-steps">Description of Key Steps</h3>
<ul>
<li><strong>Load Models</strong>: Load the pre-trained logistic regression and random forest models using pickle.</li>
<li><strong>Load Test Dataset</strong>: Load the preprocessed test dataset.</li>
<li><strong>Encode Categorical Features</strong>: Encode the categorical features using label encoding and one-hot encoding.</li>
<li><strong>Add Numerical Features</strong>: Add the numerical features to the feature set.</li>
<li><strong>Scale Numerical Features</strong>: Standardize the numerical features.</li>
<li><strong>Make Predictions</strong>:
<ul>
<li>Use the logistic regression model to predict the bike buyer class.</li>
<li>Use the random forest model to predict the bike buyer class.</li>
</ul></li>
<li><strong>Combine Predictions</strong>: Combine the predictions from both models into a single DataFrame.</li>
<li><strong>Save Predictions</strong>: Save the combined predictions to a CSV file.</li>
</ul>
<p>This approach allows you to compare the predictions from both models side by side and assess their performance.</p>
</section>
<section id="conclusion-1" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-1">Conclusion</h3>
<p>This project aimed to build a classification model to predict whether customers of Adventure Works Cycles would purchase a bike. The workflow involved several key steps: data exploration, preprocessing, model building, and prediction on test data. Below is a detailed conclusion highlighting the workflow, key insights, recommendations, and final thoughts.</p>
<section id="workflow" class="level4">
<h4 class="anchored" data-anchor-id="workflow">Workflow</h4>
<ol type="1">
<li><strong>Data Exploration</strong>:
<ul>
<li>Loaded and examined the dataset to understand the structure and types of data.</li>
<li>Identified key demographic features and purchasing behaviors.</li>
<li>Visualized relationships between different features and the target variable.</li>
</ul></li>
<li><strong>Data Preprocessing</strong>:
<ul>
<li>Merged multiple datasets to create a comprehensive view of each customer.</li>
<li>Handled missing values and duplicates to ensure data quality.</li>
<li>Encoded categorical variables and scaled numerical features to prepare the data for modeling.</li>
</ul></li>
<li><strong>Model Building</strong>:
<ul>
<li>Split the data into training and testing sets.</li>
<li>Built and trained a logistic regression model and a random forest classifier.</li>
<li>Evaluated the models using metrics such as accuracy, precision, recall, and F1-score.</li>
<li>Saved the trained logistic regression model for future use.</li>
</ul></li>
<li><strong>Prediction on Test Data</strong>:
<ul>
<li>Prepared the test data by encoding and scaling features similarly to the training data.</li>
<li>Used the trained model to predict the likelihood of bike purchases for new customers.</li>
<li>Saved the predictions to a CSV file for further analysis.</li>
</ul></li>
</ol>
</section>
<section id="key-insights" class="level4">
<h4 class="anchored" data-anchor-id="key-insights">Key Insights</h4>
<ul>
<li><strong>Demographic Influence</strong>: Certain demographic features, such as age, education level, and occupation, showed significant influence on the likelihood of purchasing a bike.</li>
<li><strong>Income Level</strong>: Higher income levels were generally associated with a higher probability of purchasing a bike.</li>
<li><strong>Feature Importance</strong>: The random forest model provided insights into feature importance, highlighting which variables were most predictive of bike purchasing behavior.</li>
</ul>
</section>
<section id="recommendations" class="level4">
<h4 class="anchored" data-anchor-id="recommendations">Recommendations</h4>
<ul>
<li><strong>Targeted Marketing</strong>: Use the insights from the model to target marketing efforts towards demographics that are more likely to purchase bikes. For example, focus on younger professionals with higher income levels.</li>
<li><strong>Customer Segmentation</strong>: Segment the customer base based on predicted likelihood of purchasing a bike and tailor promotions and communications accordingly.</li>
<li><strong>Feature Enhancement</strong>: Collect additional features that could improve the model’s predictive power, such as customer lifestyle and preferences.</li>
</ul>
</section>
<section id="final-thoughts" class="level4">
<h4 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h4>
<p>This project demonstrated the power of machine learning in predicting customer behavior and provided valuable insights for business decision-making. The classification models built in this project can be further refined and integrated into the company’s customer relationship management (CRM) systems to enhance marketing strategies and increase bike sales. Future work could involve exploring more advanced machine learning algorithms, incorporating more data sources, and conducting periodic model retraining to maintain accuracy as customer behavior evolves.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
